apiVersion: kuttl.dev/v1beta1
kind: TestStep
metadata:
  name: apply-deployment
commands:
  - command: kubectl apply -f ../test-deployment.yaml
---
apiVersion: kuttl.dev/v1beta1
kind: TestStep
metadata:
  name: verify-deployment
commands:
  - command: kubectl wait --for=condition=available deployment/test-app --timeout=60s
---
apiVersion: kuttl.dev/v1beta1
kind: TestStep
metadata:
  name: apply-elastiservice
commands:
  - command: kubectl apply -f ../test-elastiservice.yaml
---
apiVersion: kuttl.dev/v1beta1
kind: TestStep
metadata:
  name: wait-for-idle-window
timeout: 150
commands:
  - command: sleep 130
    ignoreFailure: true
---
apiVersion: kuttl.dev/v1beta1
kind: TestStep
metadata:
  name: verify-scaled-to-zero
commands:
  - command: make -C .. verify-scale REPLICAS=0
    namespaced: true
