apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  # Simulate high traffic to trigger scale up and switch to serve mode
  - command: |
      cat <<EOF | kubectl apply -f -
      apiVersion: batch/v1
      kind: Job
      metadata:
        name: high-traffic-generator
        namespace: kuttl-test
      spec:
        template:
          spec:
            containers:
            - name: traffic-gen
              image: curlimages/curl:7.83.1
              command:
              - /bin/sh
              - -c
              - |
                # Generate high test traffic to trigger serve mode
                for i in {1..50}; do
                  curl -s http://test-service.kuttl-test.svc.cluster.local || true
                  sleep 0.2
                done
            restartPolicy: Never
        backoffLimit: 0
      EOF
